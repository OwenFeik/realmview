PREAMBLE {{
if "LOGGEDIN" in kwargs or "REDIRECT" in kwargs:
  kwargs["TEST_SESSION"] = True
}}
<header>
  <nav class="navbar navbar-expand-sm navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">{{ constant(APP_TITLE) }}</a>
      <div class="collapse navbar-collapse d-flex">
        <div class="navbar-nav">
          <a class="logged-out nav-link" href="/login">Log In</a>
          <a class="logged-out nav-link" href="/register">Register</a>  
          <a class="logged-in nav-link" href="/game">Join</a>
          <a class="logged-in nav-link" href="/project">Projects</a>
          <a class="logged-in nav-link" href="/media">Media</a>
        </div>
        <div class="logged-in ms-auto navbar-nav">
          <a
            class="nav-link"
            style="cursor: pointer;"
            onclick="
              fetch('/api/auth/logout', { method: 'POST' }).then(
                () => window.location = '/'
              )
            "
          >Log Out</a>
        </div>
      </div>
    </div>
  </nav>
</header>
<script>
const REGEX = /session_key=[\dA-Z]+/;
let logged_in = document.cookie.match(REGEX);

// Hide logged in pages
document.querySelectorAll('.logged-' + (logged_in ? 'out' : 'in'))
    .forEach(el => el.classList.add("d-none"));

// Highlight the current page
if (link = document.querySelector(`a[href="${window.location.pathname}"]`)) {
    link.classList.add("active");
}
</script>  
IFDEF(TEST_SESSION) {{
<script>
fetch('/api/auth/test', { method: 'POST' }).then(
  resp => resp.json().then(body => {
    IFDEF(REDIRECT) {{
      if (body.success) {
        window.location.href = '{{ REDIRECT }}';
      }
    }}
    IFDEF(LOGGEDIN) {{
      if (!body.success) {
        window.location.href = '/login?backurl=' + window.location.pathname;
      }
    }}
  })
);
</script>
}}
