{{
  accordion_item(
    id="tools_menu",
    label="Tools",
    body=|
      <div class="btn-group" role="group" aria-label="Tool select">
        {{
          radio_check(
            id="tool_radio_select",
            group="tool_radio",
            active=1,
            label='{{ bootstrap_icon(cursor) }}',
            action="select_tool('Select')"
          )
        }}
        {{
          radio_check(
            id="tool_radio_pan",
            group="tool_radio",
            label='{{ bootstrap_icon(arrows-move) }}',
            action="select_tool('Pan')"
          )
        }}
        {{
          radio_check(
            id="tool_radio_draw",
            group="tool_radio",
            label='{{ bootstrap_icon(brush) }}',
            action="select_tool('Draw')"
          )
        }}
      </div>
    |
  )
}}
{{
  accordion_item(
    id="draw_menu",
    label="Draw",
    style="display: none;",
    body=|
      {{
        colour_input(
          id="draw_menu",
          action="c => update_draw_details('colour', c)",
          value="#FF00FF"
        )
      }}
      <div class="mt-1">
        {{
          editable_input(
            id="draw_menu_stroke",
            label="Stroke Width",
            type="number",
            min=0,
            max=1000,
            small=1,
            value=20,
            action="v => update_draw_details('stroke', v / 100)",
            noend=1
          )
        }}
          {{ dropdown_button(label="Start", secondary=1, small=1) }}
          <ul class="dropdown-menu">
            {{
              menu/draw_dropdown_option(
                key="cap_start",
                name="Arrow",
                label='Arrow {{ bootstrap_icon(arrow-left) }}'
              )
            }}
            {{
              menu/draw_dropdown_option(
                key="cap_start",
                name="Round",
                label='Round {{ bootstrap_icon(circle) }}'
              )
            }}
            {{ menu/draw_dropdown_option(key="cap_start", name="None") }}
          </ul>
          {{ dropdown_button(label="End", secondary=1, small=1) }}
          <ul class="dropdown-menu">
            {{
              menu/draw_dropdown_option(
                key="cap_end",
                name="Arrow",
                label='Arrow {{ bootstrap_icon(arrow-right) }}'
              )
            }}
            {{
              menu/draw_dropdown_option(
                key="cap_end",
                name="Round",
                label='Round {{ bootstrap_icon(circle) }}'
              )
            }}
            {{ menu/draw_dropdown_option(key="cap_end", name="None") }}
          </ul>
        </div>
        <div class="mt-1">
          <div class="btn-group" role="group" aria-label="Tool select">
            {{
              radio_check(
                group="draw_radio",
                id="draw_radio_freehand",
                active=1,
                label='{{ bootstrap_icon(brush) }}',
                action="
                  update_draw_details(
                    ['drawing_type', 'shape'], ['Freehand', null]
                  )
                "
              )
            }}
            {{
              radio_check(
                group="draw_radio",
                id="draw_radio_line",
                label='{{ bootstrap_icon(slash-lg) }}',
                action="
                  update_draw_details(
                    ['drawing_type', 'shape'], ['Line', null]
                  )
                "
              )
            }}
            {{
              radio_check(
                group="draw_radio",
                id="draw_radio_rectangle",
                label='{{ bootstrap_icon(square) }}',
                action="
                  update_draw_details(
                    ['shape', 'drawing_type'], ['Rectangle', null]
                  )
                "
              )
            }}
            {{
              radio_check(
                group="draw_radio",
                id="draw_radio_ellipse",
                label='{{ bootstrap_icon(circle) }}',
                action="
                  update_draw_details(
                    ['shape', 'drawing_type'], ['Ellipse', null]
                  )
                "
              )
            }}
          </div>
        </div>
      </div>
    |
  )
}}
<script>
function select_tool(tool) {
    document.getElementById("draw_menu").style.display = (
      tool === "Draw" ? "" : "none"
    );
    RustFuncs.select_tool(tool);
}

function update_draw_details(properties, values) {
    let obj = {};
    if (Array.isArray(properties)) {
        properties.forEach((p, i) => {
            obj[p] = values[i];
        });
    } else {
      obj[properties] = values;
    }

    RustFuncs.draw_details(JSON.stringify(obj));
}

// Generate a random colour and set as active on page load.
window.addEventListener("load", () => {
    const is_bright = c => c[0] + c[1] + c[2] >= 2.0;
    const gen_colour = () => [Math.random(), Math.random(), Math.random(), 1.0];
    const to_hex = v => Math.ceil(v * 255).toString(16).padStart(2, "0");

    let colour;
    while (!is_bright(colour = gen_colour())) {};
    
    document.getElementById("draw_menu_colour").value = (
        colour.reduce((acc, v) => acc + to_hex(v), "#").substr(0, 7)
    );
    call_when_ready(
        "draw_details", () => update_draw_details("colour", colour)
    );
});
</script>
