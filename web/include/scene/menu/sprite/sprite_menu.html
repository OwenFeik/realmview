{{
  accordion_item(
    id="sprite_menu",
    label="Sprite",
    body=|
      {{
        editable_input(
          id="sprite_menu_x",
          label="X",
          type="number",
          noend=1,
          small=1,
          action="v => update_sprite_details('x', parseInt(v))"
        )
      }}
      {{
        editable_input(
          id="sprite_menu_y",
          label="Y",
          type="number",
          nostart=1,
          noend=1,
          small=1,
          action="v => update_sprite_details('y', parseInt(v))"
        )
      }}
      {{
        editable_input(
          id="sprite_menu_w",
          label="W",
          type="number",
          nostart=1,
          noend=1,
          small=1,
          action="v => update_sprite_details('w', parseInt(v))"
        )
      }}
      {{
        editable_input(
          id="sprite_menu_h",
          label="H",
          type="number",
          nostart=1,
          small=1,
          action="v => update_sprite_details('h', parseInt(v))"
        )
      }}
      <div id="sprite_menu_colour" class="mt-1">
        {{
          editable_input(
            id="sprite_menu_r",
            label="R",
            type="number",
            min=0,
            max=255,
            noend=1,
            small=1,
            action="() => update_sprite_colour()",
          )
        }}
        {{
          editable_input(
            id="sprite_menu_g",
            label="G",
            type="number",
            min=0,
            max=255,
            nostart=1,
            noend=1,
            small=1,
            action="() => update_sprite_colour()"
          )
        }}
        {{
          editable_input(
            id="sprite_menu_b",
            label="B",
            type="number",
            min=0,
            max=255,
            nostart=1,
            noend=1,
            small=1,
            action="() => update_sprite_colour()"
          )
        }}
        {{
          editable_input(
            id="sprite_menu_a",
            label="A",
            type="number",
            min=0,
            max=255,
            nostart=1,
            small=1,
            action="() => update_sprite_colour()"
          )
        }}  
      </div>
      <div class="input-group mt-1">
        {{ dropdown_button(label="Shape", small=1) }}
        <ul class="dropdown-menu">
          {{ menu/sprite_shape_option(shape="Rectangle") }}
          {{ menu/sprite_shape_option(shape="Ellipse") }}
          {{ menu/sprite_shape_option(shape="Hexagon") }}
        </ul>
      </div>
    |
  )
}}
<script>
function update_sprite_colour(colour, value) {
    update_sprite_details(
        "colour",
        ["r", "g", "b", "a"].map(
            key => parseInt(
                document.getElementById("sprite_menu_" + key).value
            ) / 255
        )
    );
}

function update_sprite_details(property, value) {
    let id = parseInt(
        document
            .getElementById("sprite_menu_heading")
            .getAttribute("{{ constant(DATA_ID_ATTR) }}")
    );

    let obj = {};
    obj[property] = value;
    RustFuncs.sprite_details(id, JSON.stringify(obj));
}

function set_selected_sprite(sprite_json) {
    let sprite = JSON.parse(sprite_json);
    document
        .getElementById("sprite_menu_heading")
        .setAttribute("{{ constant(DATA_ID_ATTR) }}", sprite.id);

    let colour = sprite?.colour;
    let colour_keys = ["r", "g", "b", "a"];
    let colour_menu = document.getElementById("sprite_menu_colour");
    if (colour) {
        for (let i = 0; i < 4; i++) {
            sprite[colour_keys[i]] = (
                colour ? (colour[i] * 255).toFixed(0) : undefined
            );
        }
        colour_menu.style.display = "block";
    }
    else {
        colour_menu.style.display = "none";
    }

    ["x", "y", "w", "h"].concat(colour_keys).forEach(
        d => {
            let input = document.getElementById("sprite_menu_" + d);
            let v = sprite[d];
            if (v === undefined || v === null) {
                input.value = "";
                input.disabled = true;
            }
            else {
                input.value = v;
                input.disabled = false;
            }
        }
    );
}

function clear_selected_sprite() {
    set_selected_sprite('{}');
}
</script>
