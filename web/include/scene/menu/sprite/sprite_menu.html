{{
  accordion_item(
    id="sprite_menu",
    label="Sprite",
    body=|
      {{
        editable_input(
          id="sprite_menu_x",
          label="X",
          type="number",
          noend=1,
          small=1,
          action="v => update_sprite_details('x', parseInt(v))"
        )
      }}
      {{
        editable_input(
          id="sprite_menu_y",
          label="Y",
          type="number",
          nostart=1,
          noend=1,
          small=1,
          action="v => update_sprite_details('y', parseInt(v))"
        )
      }}
      {{
        editable_input(
          id="sprite_menu_w",
          label="W",
          type="number",
          nostart=1,
          noend=1,
          small=1,
          action="v => update_sprite_details('w', parseInt(v))"
        )
      }}
      {{
        editable_input(
          id="sprite_menu_h",
          label="H",
          type="number",
          nostart=1,
          small=1,
          action="v => update_sprite_details('h', parseInt(v))"
        )
      }}
      <div id="sprite_menu_colour" class="mt-1">
        {{
          colour_input(
            id="sprite_menu_colour",
            action="c => update_sprite_details('colour', c)"
          )
        }}
      </div>
      <div class="input-group mt-1">
        {{ dropdown_button(label="Shape", small=1) }}
        <ul class="dropdown-menu">
          {{ menu/sprite_shape_option(shape="Rectangle") }}
          {{ menu/sprite_shape_option(shape="Ellipse") }}
          {{ menu/sprite_shape_option(shape="Hexagon") }}
        </ul>
      </div>
    |
  )
}}
<script>
function update_sprite_details(property, value) {
    let id = parseInt(
        document
            .getElementById("sprite_menu_heading")
            .getAttribute("{{ constant(DATA_ID_ATTR) }}")
    );

    let obj = {};
    obj[property] = value;
    RustFuncs.sprite_details(id, JSON.stringify(obj));
}

function set_sprite_colour(colour) {
    const id = "sprite_menu_colour";
    const colour_menu = document.getElementById(id);
    if (colour) {
        colour_menu.style.display = "block";

        let colour_hex = "#";
        for (let i = 0; i < 3; i++) {
            let v = Math.floor(colour[i] * 255);
            colour_hex += v.toString(16).padStart(2, "0");
        }
        document.getElementById(id + "_colour").value = colour_hex;

        let alpha = colour[3];
        document.getElementById(id + "_alpha").value =
            Math.floor(alpha * 100);
    }
    else {
        colour_menu.style.display = "none";
    }

}

function set_selected_sprite(sprite_json) {
    let sprite = JSON.parse(sprite_json);
    document
        .getElementById("sprite_menu_heading")
        .setAttribute("{{ constant(DATA_ID_ATTR) }}", sprite.id);

    set_sprite_colour(sprite?.colour);
    ["x", "y", "w", "h"].forEach(
        d => {
            let input = document.getElementById("sprite_menu_" + d);
            let v = sprite[d];
            if (v === undefined || v === null) {
                input.value = "";
                input.disabled = true;
            }
            else {
                input.value = v;
                input.disabled = false;
            }
        }
    );
}

function clear_selected_sprite() {
    set_selected_sprite('{}');
}
</script>
